import crypto from 'crypto';

// snippet adapted from: https://jeffpohlmeyer.com/setting-up-a-service-account-for-uploading-to-google-drive-with-sveltekit
export default function decrypt(env) {
    const algorithm = 'aes-128-cbc';
    const { ENCRYPTION_KEY, ENCRYPTION_IV } = env;
    const encrypted = "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";

    const decipher = crypto.createDecipheriv(
        algorithm,
        ENCRYPTION_KEY,
        ENCRYPTION_IV
    );

    let decrypted = decipher.update(encrypted, 'base64', 'utf8');
    decrypted += decipher.final('utf8');
    
    return JSON.parse(decrypted);
};